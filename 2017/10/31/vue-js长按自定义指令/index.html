<!DOCTYPE html><html lang="zh-cn"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=Edge"><meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no"><meta name="format-detection" content="telephone=no"><meta name="format-detection" content="email=no"><meta name="description"><meta name="keywords" content="Hexo, Gruntjs, Nodejs, Reactjs, Vuejs"><title>vue.js长按自定义指令 - jatank.github.io</title><link rel="stylesheet" href="/css/main_style.min.css"><link rel="icon" href="/favicon.ico"></head><body><input id="navi" type="checkbox"><ul class="main-navication"><li><a href="/"><span>Home</span></a></li><li><a href="https://github.com"><span>Github</span></a></li><li><a href="https://www.v2ex.com/"><span>V2EX</span></a></li></ul><div class="wrapper" id="wrap"><div class="post-header"><label class="navi-button light" for="navi">MENU</label><img class="background" src="http://callfiles.ueibo.com/hexo-theme-laughing/post_background.jpg"><div class="post-title"><h1 class="title">vue.js长按自定义指令</h1><ul class="meta"><li><i class="icon icon-author"></i>JAtank</li><li><i class="icon icon-clock"></i>2 Minutes</li><li><i class="icon icon-calendar"></i>October 31, 2017</li></ul></div></div><div class="article-content" style="max-width:800px"><p>适用于vue.js的长按指令<br>最近的项目一直做的是Android和前端的混编。大致是用一个Android的壳子，套在里边的是通过webview加载的前端页面。前端用的是vue.js。之前有个项目中有长按事件的需求，自己通过js写了一个，但是总觉得在vue里边使用不是很舒服，所以才想着通过自定义指令封装一下。其实运用的思路和我之前的写的js是相同的，长按是通过setTimeOut()来控制实现的。具体如下：</p>
<p><pre><code><br>    /**</code></pre></p>
<pre><code> * 自定义指令：元素的长按事件
 * 使用：
 * v-long-click=&quot;callback&quot; //在一定时间后执行事件
 * v-long-click.continuous=&quot;callback&quot; //连续执行事件
 */
Vue.directive(&apos;long-click&apos;,{
  bind:function (el,binding) {
    if(typeof binding.value !== &apos;function&apos;){ //不是方法时给出提示
      console.log(&quot;-------------&quot;+binding.value+&quot;------------&quot;);
    }
    var time = 0;
    const isContinuous = binding.modifiers.continuous; //判断是否为连续执行
    const handlerStart = (e) =&gt; { //touchstart 执行事件
      if(isContinuous==true){
        el.longTime1 = setInterval(() =&gt; {
          binding.value(e);
        },300);
      }else{
        el.longTime2 = setInterval(() =&gt; {
           time++;
           if(time==15){
             binding.value(e);
             window.clearInterval(el.longTime2);
             time=0;
           }
        },100)
      }
    };
    el.__vueLongClick__ = handlerStart;
    const handlerEnd = (e) =&gt; { //touchend 执行事件
      if(isContinuous==true){
        window.clearInterval(el.longTime1);
      }else {
        window.clearInterval(el.longTime2);
      }
    };
    el.__vueLongClickOver__ = handlerEnd;
    el.addEventListener(&apos;touchstart&apos;,handlerStart); //添加事件监听
    el.addEventListener(&apos;touchend&apos;,handlerEnd);
  },
  unbind:function (el) {
    el.removeEventListener(&apos;touchstart&apos;);
    el.removeEventListener(&apos;touchend&apos;);
    el.__vueLongClick__ = null;
    el.__vueLongClickOver__=null;
  }
});
</code></pre><p><br>这个指令是通过我在网上查询其他自定义指令的书写方法来写的。分为：长按之后执行某一事件和连续执行某一事件。测试是有效的，如果有不妥的地方，大家可以帮忙指正。当然指令的具体执行间隔时间大家可以自行更改。</p>
</div><div class="article-meta" style="max-width:800px"></div><ul class="navication"><li class="home"><a href="/"><i class="icon icon-home"></i></a></li><li><a href="/2017/10/31/Andrid个推（推送）集成/"><i class="icon icon-arror-right"></i></a></li></ul><div class="page-footer"><div class="top"><ul class="social"><li><a href="https://github.com/BoizZ" title="Github" target="_blank"><i class="icon icon-github"></i></a></li><li><a href="https://weibo.com/heqibang" title="Weibo" target="_blank"><i class="icon icon-weibo"></i></a></li><li><a href="https://www.segmentfault.com/u/bon" title="SegmentFault" target="_blank"><i class="icon icon-segmentfault"></i></a></li></ul></div><div class="bottom"><p class="copyright">© 2017 jatank.github.io<br><small>POWER BY <a href="https://hexo.io" target="_blank">HEXO</a></small><small>, THEME BY <a href="https://github.com/BoizZ/hexo-theme-laughing" target="_blank">LAUGHING</a></small></p></div></div></div><script>var wrap = document.getElementById('wrap');
window.onload = function () {
  wrap.className += ' done';
}</script></body></html>